1) using burp, install JWT editor from extensions
2) go to JWT editor panel and create New RSA key and click on generate
3) right click on the generated key and click on "copy public key ad JWT"
4) go to the exploit server and paste in the body:
    {
    "keys": [
        
        copied public key

    ]
}

it will look like:
{
    "keys": [
                {
                    "kty": "RSA",
                    "e": "AQAB",
                    "kid": "68c12ba5-4acd-4377-9192-0060f7ef986b",
                    "n": "m18h2Ock42dEuwuBU0nNpxPVxrCswT1qOf-cjLBYkmt-fTdgJiP7g9C2mLN4X7srrRxm6FYYzX2ghv3RTp1aBRB8964tV9Ch-tHEY2MRYTQkVVAxGY0HYpsYclGLz2VQfqUu2uU8Mthuk8xz7CcSYbqaiRgz7RO-MgGM7dmu-uI_o1n1VqDf6CtpQvyn9hZ9Jfa5imQ42HzGYViHs0VrIurOk8pvl6S6wcTaIqpMLuVcQYdANWQmPxvi_zGUJLK_1PzisnbRPOl_l_5Fq08L6kGyaZ5Ij6YCu-qpKyS7HS-5DMcAJr9JiswSPsVE8Hhb7uENtxm79bh8qo54eWBPYQ"
                }
    ]
    
4) perform the login with wiener:peter
5) go to /my-account and send it to the repeter
6) from the repeter go to JSON web token section
7) change sub from wiener to administrator
8) change kid to KID of the genrated public key and stored in the exploit server, in this case "68c12ba5-4acd-4377-9192-0060f7ef986b"

9) add a new header
    "jku" : "exploit_server_link"

10) click on bottom on "sign" and use the RSA key generated at the beginning
11) copy the new token and paste it in session cookie in the browser
12) go to /admin and delete carlos


It works because the server will use retrieve from the link in jku the keys to use, then we have specified the key id of the key we want to use so after retrivening form the exploit server them it will use the one we specified, that is the one we used to sign our malicious token.

