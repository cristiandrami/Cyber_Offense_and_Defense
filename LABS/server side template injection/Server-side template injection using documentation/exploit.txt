https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-using-documentation


This lab is vulnerable to server-side template injection. To solve the lab, identify the template engine and use the documentation to work out how to execute arbitrary code, then delete the morale.txt file from Carlos's home directory.

You can log in to your own account using the following credentials:

content-manager:C0nt3ntM4n4g3r



1) Log in as content-manager:C0nt3ntM4n4g3r and edit one of the product description templates. Notice that this template engine uses the syntax ${someExpression} to render the result of an expression on the page. 

2) if you enter your own expression or change one of the existing ones to refer to an object that doesn't exist, such as ${foobar}, and save the template the server shows an error message from which we can understand that Freemarker template engine is used.

    Study the Freemarker documentation and find that appendix contains an FAQs section with the question "Can I allow users to upload templates and what are the security implications?". The answer describes how the new() built-in can be dangerous.

    Go to the "Built-in reference" section of the documentation and find the entry for new().

    Observe that there is a class called Execute, which can be used to execute arbitrary shell commands


3) create an expploit to remove /home/carlos/morale.txt
    <#assign ex="freemarker.template.utility.Execute"?new()> ${ ex("rm /home/carlos/morale.txt") }

4) insert it in a product template page and see the preview.
5) the template will run the code


